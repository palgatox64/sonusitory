{% extends request.htmx|yesno:"_base_empty.html,base.html" %}
{% load static %}

{% block content %}
    <div style="display: flex; align-items: flex-end; gap: 20px; margin-bottom: 2rem;">
        <div class="playlist-cover-container" style="width: 150px; height: 150px;">
            <div class="cover-placeholder"></div>
            <img 
                src="{% if playlist.cover_image_url %}{{ playlist.cover_image_url }}{% else %}{% static 'images/default_cover.png' %}{% endif %}" 
                alt="{{ playlist.name }}" 
                class="playlist-cover"
                style="width: 150px; height: 150px; border-radius: 5px; object-fit: cover;"
                onload="this.style.display='block'; this.previousElementSibling.style.display='none';">
        </div>
        <div>
            <h1>{{ playlist.name }}</h1>
            <h2>{{ playlist_songs|length }} pistas</h2>
        </div>
    </div>
    
    <div class="action-bar">
        <p>
            <a href="{% url 'playlist_list' %}" 
               hx-get="{% url 'playlist_list' %}" 
               hx-target=".main-content" 
               hx-push-url="true" 
               class="btn">
                Volver a Playlists
            </a>
            <button 
                id="edit-playlist-btn" 
                class="btn"
                data-playlist-id="{{ playlist.id }}"
                data-playlist-name="{{ playlist.name }}"
                data-playlist-cover="{{ playlist.cover_image_url|default:'' }}">
                Editar Playlist
            </button>
            <button 
                id="delete-playlist-btn" 
                class="btn btn-danger"
                data-playlist-id="{{ playlist.id }}"
                data-playlist-name="{{ playlist.name }}">
                Eliminar Playlist
            </button>
        </p>
    </div>
    
    {% if playlist_songs %}
        <ul id="sortable-song-list" class="song-list-sortable" data-playlist-id="{{ playlist.id }}">
            {% for playlist_song in playlist_songs %}
                <li class="sortable-song-item" 
                    data-song-id="{{ playlist_song.song.google_file_id }}" 
                    data-song-name="{{ playlist_song.song.title }}">
                    <div class="song-drag-handle">
                        <i class="fas fa-grip-vertical"></i>
                    </div>
                    <div class="song-content">
                        <span class="song-title">{{ playlist_song.song.title }}</span>
                        {% if playlist_song.song.artist %}
                            <span class="song-artist">por {{ playlist_song.song.artist.name }}</span>
                        {% endif %}
                    </div>
                    <div class="song-actions">
                        <button class="like-btn {% if playlist_song.song.id in liked_songs_ids %}liked{% endif %}"
                                data-song-id="{{ playlist_song.song.google_file_id }}"
                                title="Me gusta">
                            <i class="fas fa-heart"></i>
                        </button>
                        <button class="remove-from-playlist-btn"
                                data-song-id="{{ playlist_song.song.google_file_id }}"
                                data-playlist-id="{{ playlist.id }}"
                                title="Quitar de playlist">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>Esta playlist está vacía. ¡Añade algunas pistas!</p>
    {% endif %}
{% endblock %}

{% block extra_scripts %}
{{ block.super }}

{% endblock %}